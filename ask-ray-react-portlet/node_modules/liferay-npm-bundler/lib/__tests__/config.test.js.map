{"version":3,"sources":["../../src/__tests__/config.test.js"],"names":["projectDir","process","cwd","cfg","require","beforeEach","chdir","reloadConfig","afterEach","describe","it","expect","getOutputDir","toEqual","pkg","id","name","version","dir","getExclusions","plugins","getPlugins","run","config","getBabelConfig","only","versions","getVersionsInfo","myVersion","Object","keys","length"],"mappings":"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","file":"config.test.js","sourcesContent":["const projectDir = process.cwd();\nconst cfg = require('../config');\n\nbeforeEach(() => {\n\tprocess.chdir(\n\t\t`${projectDir}/packages/liferay-npm-bundler/src/__tests__/config/` +\n\t\t\t'default'\n\t);\n\tcfg.reloadConfig();\n});\n\nafterEach(() => {\n\tprocess.chdir(projectDir);\n});\n\ndescribe('getOutputDir()', () => {\n\tit('works', () => {\n\t\texpect(cfg.getOutputDir()).toEqual('output-dir');\n\t});\n});\n\ndescribe('getExclusions()', () => {\n\tit('works for unversioned packages', () => {\n\t\tconst pkg = {\n\t\t\tid: 'package-a@2.0.0',\n\t\t\tname: 'package-a',\n\t\t\tversion: '2.0.0',\n\t\t\tdir: '',\n\t\t};\n\n\t\texpect(cfg.getExclusions(pkg)).toEqual(['*']);\n\t});\n\n\tit('works for versioned packages', () => {\n\t\tconst pkg = {\n\t\t\tid: 'package-b@1.0.0',\n\t\t\tname: 'package-b',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t};\n\n\t\texpect(cfg.getExclusions(pkg)).toEqual(['**/*.js', '**/*.css']);\n\t});\n\n\tit('returns the default exclusions for unconfigured packages', () => {\n\t\tconst pkg = {\n\t\t\tid: 'not-existent-package@1.0.0',\n\t\t\tname: 'not-existent-package',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t};\n\n\t\texpect(cfg.getExclusions(pkg)).toEqual(['test/**/*']);\n\t});\n\n\t// Impossible to test once we test for default exclusions\n\tit('returns an empty array for unconfigured packages', () => {\n\t\tprocess.chdir(\n\t\t\t`${projectDir}/packages/liferay-npm-bundler/src/__tests__/config/` +\n\t\t\t\t'empty'\n\t\t);\n\t\tcfg.reloadConfig();\n\n\t\tconst pkg = {\n\t\t\tid: 'not-existent-package@1.0.0',\n\t\t\tname: 'not-existent-package',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t};\n\n\t\texpect(cfg.getExclusions(pkg)).toEqual([]);\n\t});\n});\n\ndescribe('getPlugins()', () => {\n\tit('loads default \"pre\" plugins correctly', () => {\n\t\tconst plugins = cfg.getPlugins('pre', {\n\t\t\tid: 'package-star@1.0.0',\n\t\t\tname: 'package-star',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\n\t\texpect(plugins[0].run({}, {})).toEqual(0);\n\t\texpect(plugins[0].config).toEqual({});\n\n\t\texpect(plugins[1].run({}, {})).toEqual(1);\n\t\texpect(plugins[1].config).toEqual('config-1');\n\t});\n\n\tit('loads default \"post\" plugins correctly', () => {\n\t\tconst plugins = cfg.getPlugins('post', {\n\t\t\tid: 'package-star@1.0.0',\n\t\t\tname: 'package-star',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\n\t\texpect(plugins[0].run({}, {})).toEqual(2);\n\t\texpect(plugins[0].config).toEqual({});\n\n\t\texpect(plugins[1].run({}, {})).toEqual(3);\n\t\texpect(plugins[1].config).toEqual('config-3');\n\t});\n\n\tit('loads per-package \"pre\" plugins correctly', () => {\n\t\tconst plugins = cfg.getPlugins('pre', {\n\t\t\tid: 'package@1.0.0',\n\t\t\tname: 'package',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\n\t\texpect(plugins[0].run({}, {})).toEqual(4);\n\t\texpect(plugins[0].config).toEqual({});\n\n\t\texpect(plugins[1].run({}, {})).toEqual(5);\n\t\texpect(plugins[1].config).toEqual('config-5');\n\t});\n\n\tit('loads per-package \"post\" plugins correctly', () => {\n\t\tconst plugins = cfg.getPlugins('post', {\n\t\t\tid: 'package@1.0.0',\n\t\t\tname: 'package',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\n\t\texpect(plugins[0].run({}, {})).toEqual(6);\n\t\texpect(plugins[0].config).toEqual({});\n\n\t\texpect(plugins[1].run({}, {})).toEqual(7);\n\t\texpect(plugins[1].config).toEqual('config-7');\n\t});\n\n\tit('supports legacy package configurations correctly', () => {\n\t\tprocess.chdir(\n\t\t\t`${projectDir}/packages/liferay-npm-bundler/src/__tests__/config/` +\n\t\t\t\t'legacy-packages'\n\t\t);\n\t\tcfg.reloadConfig();\n\n\t\tlet plugins = cfg.getPlugins('pre', {\n\t\t\tid: 'package@1.0.0',\n\t\t\tname: 'package',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\t\texpect(plugins[0].run({}, {})).toEqual(1);\n\n\t\tplugins = cfg.getPlugins('pre', {\n\t\t\tid: 'package2@1.0.0',\n\t\t\tname: 'package2',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\t\texpect(plugins[0].run({}, {})).toEqual(2);\n\n\t\tplugins = cfg.getPlugins('pre', {\n\t\t\tid: 'package3@1.0.0',\n\t\t\tname: 'package3',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\t\texpect(plugins[0].run({}, {})).toEqual(4);\n\n\t\tplugins = cfg.getPlugins('pre', {\n\t\t\tid: 'unconfigured-package@1.0.0',\n\t\t\tname: 'unconfigured-package',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\t\texpect(plugins[0].run({}, {})).toEqual(0);\n\t});\n});\n\ndescribe('getBabelConfig()', () => {\n\tit('loads default config correctly', () => {\n\t\tconst config = cfg.getBabelConfig({\n\t\t\tid: 'package-star@1.0.0',\n\t\t\tname: 'package-star',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\n\t\texpect(config).toEqual({config: 'config-*'});\n\t});\n\n\tit('loads per-package config correctly when configured by id', () => {\n\t\tconst config = cfg.getBabelConfig({\n\t\t\tid: 'package@1.0.0',\n\t\t\tname: 'package',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\n\t\texpect(config).toEqual({config: 'config-package@1.0.0'});\n\t});\n\n\tit('loads per-package config correctly when configured by name', () => {\n\t\tconst config = cfg.getBabelConfig({\n\t\t\tid: 'package2@1.0.0',\n\t\t\tname: 'package2',\n\t\t\tversion: '1.0.0',\n\t\t\tdir: '',\n\t\t});\n\n\t\texpect(config).toEqual({config: 'config-package2'});\n\t});\n});\n\ndescribe('getPluginVersions()', () => {\n\tit.only('analyzes default config correctly', () => {\n\t\tconst versions = cfg.getVersionsInfo();\n\t\tconst myVersion = require('../../package.json').version;\n\n\t\texpect(Object.keys(versions).length).toEqual(9);\n\t\texpect(versions['liferay-npm-bundler']).toEqual(myVersion);\n\t\texpect(versions['liferay-npm-bundler-plugin-test-0']).toEqual('1.0.0');\n\t\texpect(versions['liferay-npm-bundler-plugin-test-1']).toEqual('1.0.1');\n\t\texpect(versions['liferay-npm-bundler-plugin-test-2']).toEqual('1.0.2');\n\t\texpect(versions['liferay-npm-bundler-plugin-test-3']).toEqual('1.0.3');\n\t\texpect(versions['liferay-npm-bundler-plugin-test-4']).toEqual('1.0.4');\n\t\texpect(versions['liferay-npm-bundler-plugin-test-5']).toEqual('1.0.5');\n\t\texpect(versions['liferay-npm-bundler-plugin-test-6']).toEqual('1.0.6');\n\t\texpect(versions['liferay-npm-bundler-plugin-test-7']).toEqual('1.0.7');\n\t});\n});\n"]}