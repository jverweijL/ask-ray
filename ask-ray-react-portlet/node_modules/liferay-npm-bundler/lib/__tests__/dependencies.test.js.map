{"version":3,"sources":["../../src/__tests__/dependencies.test.js"],"names":["expect","extend","toMatchDependencies","deps","pkgIds","missingDeps","extraDeps","invalidDepFields","forEach","dep","pkgId","push","pkgIdParts","split","pkgName","pkgVersion","invalidFields","id","name","version","expectedDepDir","normalize","dir","endsWith","Object","keys","length","indexOf","depId","pass","message","JSON","stringify","beforeAll","process","chdir","afterAll","it"],"mappings":";;AAAA;;;;AACA;;;;AAEAA,OAAOC,MAAP,CAAc;AACbC,oBADa,+BACOC,IADP,EACwB;AAAA,oCAARC,MAAQ;AAARA,SAAQ;AAAA;;AACpC,MAAIC,cAAc,EAAlB;AACA,MAAIC,YAAY,EAAhB;AACA,MAAIC,mBAAmB,EAAvB;;AAEAH,SAAOI,OAAP,CAAe,iBAAS;AACvB,OAAMC,MAAMN,KAAKO,KAAL,CAAZ;;AAEA,OAAI,CAACD,GAAL,EAAU;AACTJ,gBAAYM,IAAZ,CAAiBD,KAAjB;AACA,IAFD,MAEO;AACN,QAAME,aAAaF,MAAMG,KAAN,CAAY,GAAZ,CAAnB;AACA,QAAMC,UAAUF,WAAW,CAAX,CAAhB;AACA,QAAMG,aAAaH,WAAW,CAAX,CAAnB;AACA,QAAII,gBAAgBT,iBAAiBG,KAAjB,KAA2B,EAA/C;;AAEA,QAAID,IAAIQ,EAAJ,IAAUP,KAAd,EAAqB;AACpBM,mBAAcC,EAAd,GAAsBR,IAAIQ,EAA1B,oBAA2CP,KAA3C;AACA;;AAED,QAAID,IAAIS,IAAJ,IAAYJ,OAAhB,EAAyB;AACxBE,mBAAcE,IAAd,GAAwBT,IAAIS,IAA5B,oBAA+CJ,OAA/C;AACA;;AAED,QAAIL,IAAIU,OAAJ,IAAeJ,UAAnB,EAA+B;AAC9BC,mBAAcG,OAAd,GACIV,IAAIU,OAAP,0BAAkCJ,UAAlC,OADD;AAEA;;AAED,QAAMK,iBAAiB,eAAKC,SAAL,oBACLP,OADK,CAAvB;;AAIA,QAAIL,IAAIa,GAAJ,IAAW,GAAX,IAAkB,CAACb,IAAIa,GAAJ,CAAQC,QAAR,CAAiBH,cAAjB,CAAvB,EAAyD;AACxDJ,mBAAcM,GAAd,GACIb,IAAIa,GAAP,6BAAiCF,cAAjC,OADD;AAEA;;AAED,QAAII,OAAOC,IAAP,CAAYT,aAAZ,EAA2BU,MAA3B,GAAoC,CAAxC,EAA2C;AAC1CnB,sBAAiBG,KAAjB,IAA0BM,aAA1B;AACA;AACD;AACD,GArCD;;AAuCAQ,SAAOC,IAAP,CAAYtB,IAAZ,EAAkBK,OAAlB,CAA0B,iBAAS;AAClC,OAAIJ,OAAOuB,OAAP,CAAeC,KAAf,KAAyB,CAAC,CAA9B,EAAiC;AAChCtB,cAAUK,IAAV,CAAeiB,KAAf;AACA;AACD,GAJD;;AAMA,MAAIC,OAAO,IAAX;AACA,MAAIC,UAAU,EAAd;;AAEA,MAAIzB,YAAYqB,MAAZ,GAAqB,CAAzB,EAA4B;AAC3BI,oDAA+CzB,WAA/C;AACAwB,UAAO,KAAP;AACA;;AAED,MAAIvB,UAAUoB,MAAV,GAAmB,CAAvB,EAA0B;AACzBI,sDAAiDxB,SAAjD;AACAuB,UAAO,KAAP;AACA;;AAED,MAAIL,OAAOC,IAAP,CAAYlB,gBAAZ,EAA8BmB,MAA9B,GAAuC,CAA3C,EAA8C;AAC7CI,gDAA2CC,KAAKC,SAAL,CAC1CzB,gBAD0C,EAE1C,EAF0C,EAG1C,CAH0C,CAA3C;AAKAsB,UAAO,KAAP;AACA;;AAED,SAAO;AACNC,mBADM;AAEND;AAFM,GAAP;AAIA;AA7EY,CAAd;;AAgFAI,UAAU,YAAM;AACfC,SAAQC,KAAR,CAAc,8CAAd;AACA,CAFD;;AAIAC,SAAS,YAAM;AACdF,SAAQC,KAAR,CAAc,aAAd;AACA,CAFD;;AAIAE,GAAG,sCAAH,EAA2C,YAAM;AAChD,KAAMlC,OAAO,0CAAuB,GAAvB,CAAb;;AAEAH,QAAOG,IAAP,EAAaD,mBAAb,CACC,oBADD,EAEC,0BAFD,EAGC,0BAHD,EAIC,0BAJD;AAMA,CATD;;AAWAmC,GAAG,sCAAH,EAA2C,YAAM;AAChD,KAAMlC,OAAO,0CAAuB,GAAvB,EAA4B,CAAC,eAAD,CAA5B,CAAb;;AAEAH,QAAOG,IAAP,EAAaD,mBAAb,CACC,qBADD,EAEC,oBAFD,EAGC,0BAHD,EAIC,0BAJD,EAKC,0BALD;AAOA,CAVD","file":"dependencies.test.js","sourcesContent":["import path from 'path';\nimport {getPackageDependencies} from '../dependencies';\n\nexpect.extend({\n\ttoMatchDependencies(deps, ...pkgIds) {\n\t\tlet missingDeps = [];\n\t\tlet extraDeps = [];\n\t\tlet invalidDepFields = {};\n\n\t\tpkgIds.forEach(pkgId => {\n\t\t\tconst dep = deps[pkgId];\n\n\t\t\tif (!dep) {\n\t\t\t\tmissingDeps.push(pkgId);\n\t\t\t} else {\n\t\t\t\tconst pkgIdParts = pkgId.split('@');\n\t\t\t\tconst pkgName = pkgIdParts[0];\n\t\t\t\tconst pkgVersion = pkgIdParts[1];\n\t\t\t\tlet invalidFields = invalidDepFields[pkgId] || {};\n\n\t\t\t\tif (dep.id != pkgId) {\n\t\t\t\t\tinvalidFields.id = `${dep.id} (expected: ${pkgId})`;\n\t\t\t\t}\n\n\t\t\t\tif (dep.name != pkgName) {\n\t\t\t\t\tinvalidFields.name = `${dep.name} (expected: ${pkgName})`;\n\t\t\t\t}\n\n\t\t\t\tif (dep.version != pkgVersion) {\n\t\t\t\t\tinvalidFields.version =\n\t\t\t\t\t\t`${dep.version} ` + `(expected: ${pkgVersion})`;\n\t\t\t\t}\n\n\t\t\t\tconst expectedDepDir = path.normalize(\n\t\t\t\t\t`/node_modules/${pkgName}`\n\t\t\t\t);\n\n\t\t\t\tif (dep.dir != '.' && !dep.dir.endsWith(expectedDepDir)) {\n\t\t\t\t\tinvalidFields.dir =\n\t\t\t\t\t\t`${dep.dir} ` + `(expected: ...${expectedDepDir})`;\n\t\t\t\t}\n\n\t\t\t\tif (Object.keys(invalidFields).length > 0) {\n\t\t\t\t\tinvalidDepFields[pkgId] = invalidFields;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tObject.keys(deps).forEach(depId => {\n\t\t\tif (pkgIds.indexOf(depId) == -1) {\n\t\t\t\textraDeps.push(depId);\n\t\t\t}\n\t\t});\n\n\t\tlet pass = true;\n\t\tlet message = '';\n\n\t\tif (missingDeps.length > 0) {\n\t\t\tmessage += `\\nRequired dependencies missing: ${missingDeps}\\n`;\n\t\t\tpass = false;\n\t\t}\n\n\t\tif (extraDeps.length > 0) {\n\t\t\tmessage += `\\nNot required dependencies found: ${extraDeps}\\n`;\n\t\t\tpass = false;\n\t\t}\n\n\t\tif (Object.keys(invalidDepFields).length > 0) {\n\t\t\tmessage += `\\nInvalid dependency fields: ${JSON.stringify(\n\t\t\t\tinvalidDepFields,\n\t\t\t\t'',\n\t\t\t\t2\n\t\t\t)}\\n`;\n\t\t\tpass = false;\n\t\t}\n\n\t\treturn {\n\t\t\tmessage,\n\t\t\tpass,\n\t\t};\n\t},\n});\n\nbeforeAll(() => {\n\tprocess.chdir('./packages/liferay-npm-bundler/src/__tests__');\n});\n\nafterAll(() => {\n\tprocess.chdir('../../../..');\n});\n\nit('loads project dependencies correctly', () => {\n\tconst deps = getPackageDependencies('.');\n\n\texpect(deps).toMatchDependencies(\n\t\t'test-project@1.0.0',\n\t\t'test-project-dep-0@1.0.0',\n\t\t'test-project-dep-1@1.0.0',\n\t\t'test-project-dep-0@0.1.0'\n\t);\n});\n\nit('appends extra dependencies correctly', () => {\n\tconst deps = getPackageDependencies('.', ['stale-package']);\n\n\texpect(deps).toMatchDependencies(\n\t\t'stale-package@1.0.0',\n\t\t'test-project@1.0.0',\n\t\t'test-project-dep-0@1.0.0',\n\t\t'test-project-dep-1@1.0.0',\n\t\t'test-project-dep-0@0.1.0'\n\t);\n});\n"]}